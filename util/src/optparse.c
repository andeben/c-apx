
//////////////////////////////////////////////////////////////////////////////
// INCLUDES
//////////////////////////////////////////////////////////////////////////////
#include <stdio.h>
#include <string.h>
#include "optparse.h"

//////////////////////////////////////////////////////////////////////////////
// CONSTANTS AND DATA TYPES
//////////////////////////////////////////////////////////////////////////////

//////////////////////////////////////////////////////////////////////////////
// LOCAL FUNCTION PROTOTYPES
//////////////////////////////////////////////////////////////////////////////

//////////////////////////////////////////////////////////////////////////////
// GLOBAL VARIABLES
//////////////////////////////////////////////////////////////////////////////

//////////////////////////////////////////////////////////////////////////////
// LOCAL VARIABLES
//////////////////////////////////////////////////////////////////////////////


//////////////////////////////////////////////////////////////////////////////
// GLOBAL FUNCTIONS
//////////////////////////////////////////////////////////////////////////////
bool optparse(int argc, char **argv, parse_flags_fn *flagsfunc, parse_opt_fn *optfunc)
{
   int i;
   bool retval = true;
   for (i = 1; i<argc; i++)
   {
      char *arg = argv[i];      
      if (strncmp(arg, "--", 2) == 0)
      {
         char *name = &arg[2];
         char *val = strchr(name, '=');
         if (val == 0)
         {
            //value is in next argv
            if (i < argc)
            {
               val = argv[++i];
            }
            else
            {               
               break;
            }
         }
         else
         {
            //partition by '='
            *val = '\0';
            val = val + 1;
         }
         if (optfunc)
         {
            retval = optfunc(name, val);
         }
      }
      else if ( (strncmp(arg, "-", 1) == 0) && (flagsfunc != 0) )
      {
         retval = flagsfunc(&arg[1]);
      }
      if (retval == false)
      {
         break;
      }
   }
   return retval;
}


//////////////////////////////////////////////////////////////////////////////
// LOCAL FUNCTIONS
//////////////////////////////////////////////////////////////////////////////

